<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Use correct character set. -->
    <meta charset="utf-8" />
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <title>Hello World!</title>
    <script src="../Build/Cesium/Cesium.js"></script>
    <style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html,
      body,
      #cesiumContainer {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer"></div>
    <script>
      var viewer = new Cesium.Viewer("cesiumContainer", {
        baseLayerPicker: true,
        timeline: false,
        animation: false,
        homeButton: false,
        vrButton: false,
        vrButton: true,
        geocoder: false,
        sceneModelPicker: false,
        navigationHelpButton: false
       });
      
// How to use the 3D Tiles Styling language to style individual features, like buildings.
// Styling language specification: https://github.com/CesiumGS/3d-tiles/tree/master/specification/Styling
      /*var viewer = new Cesium.Viewer("cesiumContainer", {
          terrainProvider: Cesium.createWorldTerrain(),
      });*/
      var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

//点と線
        var point_Fukui = viewer.entities.add({
            name:"福井市", //レイヤ名
            description:"ここは福井市です。", //レイヤの説明
            position:Cesium.Cartesian3.fromDegrees(136.223554, 36.0619, 0), //経度,緯度,高さ
            point:{
                pixelSize:10, //ポイントサイズ
                color:Cesium.Color.BLUE //ポイントの色
            }
        });
      
       var point_Chino = viewer.entities.add({
            name:"茅野市", //レイヤ名
            description:"ここは茅野市です。", //レイヤの説明
            position:Cesium.Cartesian3.fromDegrees(138.158805, 35.995527, 0), //経度,緯度,高さ
            point:{
                pixelSize:10, //ポイントサイズ
                color:Cesium.Color.YELLOW //ポイントの色
            }
        });
      
      var Line_Chino = viewer.entities.add({
            name:"茅野市内鉄道", //レイヤ名
            description:"茅野市内の鉄道", //レイヤの説明
            polyline:{
              positions:Cesium.Cartesian3.fromDegreesArrayHeights([138.139166, 36.010555, 0,
                138.141111, 36.008055, 0,
                138.144444, 36.003888, 0,
                138.147777, 35.999722, 0,
                138.151944, 35.994722, 0, //茅野駅
                138.152500, 35.993888, 0,
                138.156388, 35.988333, 0,
                138.157500, 35.987777, 0,
                138.159444, 35.986666, 0,
                138.161944, 35.983888, 0,
                138.163888, 35.981944, 0,
                138.166111, 35.980555, 0,
                138.171388, 35.974444, 0,
                138.172222, 35.973611, 0,
                138.173050, 35.970000, 0,
                138.173611, 35.968888, 0,
                138.178611, 35.961111, 0,
                138.179444, 35.960555, 0,
                138.186044, 35.953333, 0,
                138.188055, 35.952777, 0,
                138.189722, 35.950000, 0,
                138.193611, 35.946944, 0,
                138.199722, 35.939722, 0,
                138.200555, 35.938888, 0
              ]), //経度,緯度,高さ
              width:3,
              material:Cesium.Color.RED
            }
        });
      
      var Chino_3Dtiles = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
          url:"	http://suwarika-miyo.main.jp/ayukawa/Chino_3Dtiles/tileset.json"
       }));
      
        viewer.zoomTo(viewer.entities); //レイヤにズーム
      
// Add Cesium OSM buildings to the scene as our example 3D Tileset.
      var osmBuildingsTileset = Cesium.createOsmBuildings();
      viewer.scene.primitives.add(osmBuildingsTileset);

// Set the initial camera to look at Seattle
      viewer.scene.camera.setView({
        destination: Cesium.Cartesian3.fromDegrees(-122.3472, 47.598, 370),
        orientation: {
    heading: Cesium.Math.toRadians(10),
    pitch: Cesium.Math.toRadians(-10),
  },
});

// Styling functions

// Color by material checks for null values since not all
// buildings have the material property.
function colorByMaterial() {
  osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
    defines: {
      material: "${feature['building:material']}",
    },
    color: {
      conditions: [
        ["${material} === null", "color('white')"],
        ["${material} === 'glass'", "color('skyblue', 0.5)"],
        ["${material} === 'concrete'", "color('grey')"],
        ["${material} === 'brick'", "color('indianred')"],
        ["${material} === 'stone'", "color('lightslategrey')"],
        ["${material} === 'metal'", "color('lightgrey')"],
        ["${material} === 'steel'", "color('lightsteelblue')"],
        ["true", "color('white')"], // This is the else case
      ],
    },
  });
}

function highlightAllResidentialBuildings() {
  osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
    color: {
      conditions: [
        [
          "${feature['building']} === 'apartments' || ${feature['building']} === 'residential'",
          "color('cyan', 0.9)",
        ],
        [true, "color('white')"],
      ],
    },
  });
}

function showByBuildingType(buildingType) {
  switch (buildingType) {
    case "office":
      osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
        show: "${feature['building']} === 'office'",
      });
      break;
    case "apartments":
      osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
        show: "${feature['building']} === 'apartments'",
      });
      break;
    default:
      break;
  }
}

// Color the buildings based on their distance from a selected central location
function colorByDistanceToCoordinate(pickedLatitude, pickedLongitude) {
  osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
    defines: {
      distance:
        "distance(vec2(${feature['cesium#longitude']}, ${feature['cesium#latitude']}), vec2(" +
        pickedLongitude +
        "," +
        pickedLatitude +
        "))",
    },
    color: {
      conditions: [
        ["${distance} > 0.014", "color('blue')"],
        ["${distance} > 0.010", "color('green')"],
        ["${distance} > 0.006", "color('yellow')"],
        ["${distance} > 0.0001", "color('red')"],
        ["true", "color('white')"],
      ],
    },
  });
}

// When dropdown option is not "Color By Distance To Selected Location",
// remove the left click input event for selecting a central location
function removeCoordinatePickingOnLeftClick() {
  document.querySelector(".infoPanel").style.visibility = "hidden";
  handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
}

// Add event listeners to dropdown menu options
document.querySelector(".infoPanel").style.visibility = "hidden";
var menu = document.getElementById("dropdown");

menu.options[0].onselect = function () {
  removeCoordinatePickingOnLeftClick();
  colorByMaterial();
};

menu.options[1].onselect = function () {
  // Default to Space Needle as the central location
  colorByDistanceToCoordinate(47.62051, -122.34931);
  document.querySelector(".infoPanel").style.visibility = "visible";
  // Add left click input to select a building to and extract its coordinates
  handler.setInputAction(function (movement) {
    viewer.selectedEntity = undefined;
    var pickedBuilding = viewer.scene.pick(movement.position);
    if (pickedBuilding) {
      var pickedLatitude = pickedBuilding.getProperty(
        "cesium#latitude"
      );
      var pickedLongitude = pickedBuilding.getProperty(
        "cesium#longitude"
      );
      colorByDistanceToCoordinate(pickedLatitude, pickedLongitude);
    }
  }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
};

menu.options[2].onselect = function () {
  removeCoordinatePickingOnLeftClick();
  highlightAllResidentialBuildings();
};

menu.options[3].onselect = function () {
  removeCoordinatePickingOnLeftClick();
  showByBuildingType("office");
};

menu.options[4].onselect = function () {
  removeCoordinatePickingOnLeftClick();
  showByBuildingType("apartments");
};

menu.onchange = function () {
  Sandcastle.reset();
  var item = menu.options[menu.selectedIndex];
  if (item && typeof item.onselect === "function") {
    item.onselect();
  }
};

colorByMaterial();

    </script>
  </body>
</html>
